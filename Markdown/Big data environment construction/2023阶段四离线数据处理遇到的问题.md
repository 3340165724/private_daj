# 2023阶段四离线数据处理遇到的问题

- ## 1、[覆盖数据到dwd层](#OverwriteDwd)





## 1、<a id="OverwriteDwd">覆盖数据到dwd层</a>

- ### 错误

  ```
  2023-09-07 21:33:58,710 WARN metastore.ObjectStore: Failed to get database global_temp, returning NoSuchObjectException
  org.apache.spark.sql.AnalysisException: Cannot overwrite table 2023_dwd1_ds_db01.dim_customer_inf that is also being read from
  ```

- ### 原因

  - 无法边读边写

- ### 解决

  ```
  // 注释这种写入方式
  all_df.write.mode(SaveMode.Overwrite).format("hive").partitionBy("etl_date").saveAsTable(s"2023_dwd1_ds_db01.dim_${table}") 
  
  // 使用insert语句覆盖写入表的时候不存在读写的问题
  all_df.createOrReplaceTempView("mytable")
  spark.sql(s"insert overwrite 2023_dwd1_ds_db01.dim_${table} select `(etl_date)?+.+`,etl_date from mytable")
  // 注意应用正则表达式
   .config("spark.sql.parser.quotedRegexColumnNames", "true") // 允许在用引号引起来的列名称中使用正则表达式
  ```

  